{"version":3,"sources":["memoryDetector.js"],"names":["cc","Class","extends","Component","properties","TAG","ctor","console","log","onLoad","onDestroy","showMemoryStatus","sys","isNative","_memLabel","profiler","showStats","createMemLabel","document","createElement","_fps","getElementById","style","height","color","font","lineHeight","width","appendChild","afterVisit","count","totalBytes","locTexrues","textureCache","_textures","key","selTexture","getPixelWidth","getPixelHeight","locTextureColorsCache","_textureColorsCache","selCanvasColorsArr","selCanvasKey","selCanvas","innerHTML","toFixed","director","on","Director","EVENT_AFTER_VISIT","_inited"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,aAAK;AADG,KAHP;;AAOLC,UAAM,gBAAY;AACdC,gBAAQC,GAAR,CAAY,UAAU,KAAKH,GAA3B;AACH,KATI;;AAWLI,YAAQ,kBAAY;AAChBF,gBAAQC,GAAR,CAAY,WAAW,KAAKH,GAA5B;AACH,KAbI;;AAeLK,eAAW,qBAAY;AACnBH,gBAAQC,GAAR,CAAY,cAAc,KAAKH,GAA/B;AACH,KAjBI;;AAmBLM,sBAAkB,4BAAY;AAC1B,YAAIX,GAAGY,GAAH,CAAOC,QAAX,EAAqB;AACjB;AACH;;AAED,YAAIC,YAAY,IAAhB;AACA,YAAIC,WAAWf,GAAGe,QAAlB;AACAA,iBAASC,SAAT;;AAEA,YAAIC,iBAAiB,SAAjBA,cAAiB,GAAY;AAC7BH,wBAAYI,SAASC,aAAT,CAAuB,KAAvB,CAAZ;AACAJ,qBAASK,IAAT,GAAgBF,SAASG,cAAT,CAAwB,KAAxB,CAAhB;AACAN,qBAASK,IAAT,CAAcE,KAAd,CAAoBC,MAApB,GAA6B,OAA7B;;AAEA,gBAAID,QAAQR,UAAUQ,KAAtB;AACAA,kBAAME,KAAN,GAAc,kBAAd;AACAF,kBAAMG,IAAN,GAAa,4BAAb;AACAH,kBAAMI,UAAN,GAAmB,OAAnB;AACAJ,kBAAMK,KAAN,GAAc,MAAd;AACAZ,qBAASK,IAAT,CAAcQ,WAAd,CAA0Bd,SAA1B;AACH,SAXD;;AAaAG;;AAEA,YAAIY,aAAa,SAAbA,UAAa,GAAY;AACzB,gBAAIC,QAAQ,CAAZ;AACA,gBAAIC,aAAa,CAAjB;AACA,gBAAIC,aAAahC,GAAGiC,YAAH,CAAgBC,SAAjC;;AAEA,iBAAK,IAAIC,GAAT,IAAgBH,UAAhB,EAA4B;AACxB,oBAAII,aAAaJ,WAAWG,GAAX,CAAjB;AACAL;AACAC,8BAAcK,WAAWC,aAAX,KAA6BD,WAAWE,cAAX,EAA7B,GAA2D,CAAzE;AACH;;AAED,gBAAIC,wBAAwBvC,GAAGiC,YAAH,CAAgBO,mBAA5C;;AAEA,iBAAK,IAAIL,IAAT,IAAgBI,qBAAhB,EAAuC;AACnC,oBAAIE,qBAAqBF,sBAAsBJ,IAAtB,CAAzB;AACA,qBAAK,IAAIO,YAAT,IAAyBD,kBAAzB,EAA6C;AACzC,wBAAIE,YAAYF,mBAAmBC,YAAnB,CAAhB;AACAZ;AACAC,kCAAcY,UAAUhB,KAAV,GAAkBgB,UAAUpB,MAA5B,GAAqC,CAAnD;AACH;AACJ;;AAEDT,sBAAU8B,SAAV,GAAsB,eAAe,CAACb,cAAc,SAAS,MAAvB,CAAD,EAAiCc,OAAjC,CAAyC,CAAzC,CAAf,GAA6D,IAAnF;AACH,SAvBD;;AAyBA7C,WAAG8C,QAAH,CAAYC,EAAZ,CAAe/C,GAAGgD,QAAH,CAAYC,iBAA3B,EAA8CpB,UAA9C;AACA,aAAKqB,OAAL,GAAe,IAAf;AACH;AAtEI,CAAT","file":"memoryDetector.js","sourceRoot":"../../../../../assets/Script/AtomFrame","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        TAG: \"MemoryDetector\",\n    },\n\n    ctor: function () {\n        console.log(\"-new:\" + this.TAG);\n    },\n\n    onLoad: function () {\n        console.log(\"-load:\" + this.TAG);\n    },\n\n    onDestroy: function () {\n        console.log(\"-destory:\" + this.TAG);\n    },\n\n    showMemoryStatus: function () {\n        if (cc.sys.isNative) {\n            return;\n        }\n\n        let _memLabel = null;\n        let profiler = cc.profiler;\n        profiler.showStats();\n\n        let createMemLabel = function () {\n            _memLabel = document.createElement('div');\n            profiler._fps = document.getElementById('fps');\n            profiler._fps.style.height = '100px';\n\n            let style = _memLabel.style;\n            style.color = 'rgb(0, 255, 255)';\n            style.font = 'bold 12px Helvetica, Arial';\n            style.lineHeight = '20px;';\n            style.width = '100%';\n            profiler._fps.appendChild(_memLabel);\n        }\n\n        createMemLabel();\n\n        let afterVisit = function () {\n            let count = 0;\n            let totalBytes = 0;\n            let locTexrues = cc.textureCache._textures;\n\n            for (let key in locTexrues) {\n                let selTexture = locTexrues[key];\n                count++;\n                totalBytes += selTexture.getPixelWidth() * selTexture.getPixelHeight() * 4;\n            }\n\n            let locTextureColorsCache = cc.textureCache._textureColorsCache;\n\n            for (let key in locTextureColorsCache) {\n                let selCanvasColorsArr = locTextureColorsCache[key];\n                for (let selCanvasKey in selCanvasColorsArr) {\n                    let selCanvas = selCanvasColorsArr[selCanvasKey];\n                    count++;\n                    totalBytes += selCanvas.width * selCanvas.height * 4;\n                }\n            }\n\n            _memLabel.innerHTML = \"  Memory  \" + (totalBytes / (1024.0 * 1024.0)).toFixed(2) + \" M\";\n        }\n\n        cc.director.on(cc.Director.EVENT_AFTER_VISIT, afterVisit);\n        this._inited = true;\n    },\n});\n"]}